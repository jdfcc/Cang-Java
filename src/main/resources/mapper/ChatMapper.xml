<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.Cang.mapper.ChatMapper">


    <select id="selectLast" resultType="com.Cang.entity.Chat">
        select id, send, receive, message, max(create_time) as createTime, `like`, user_key
        from tb_chat
        where user_key in (SELECT user_key
                           FROM tb_chat
                           WHERE receive = #{userid}
                              OR send = #{userid})
        GROUP BY user_key;
    </select>

    <select id="selectDtos" resultType="com.Cang.dto.ChatDto">
        SELECT tb_chat.id id, icon avatar, message, send, receive
        FROM tb_chat
                 JOIN
             tb_user
        WHERE send = tb_user.id
          AND user_key = #{userKey}
        ORDER BY tb_chat.create_time ASC;
    </select>

</mapper>
